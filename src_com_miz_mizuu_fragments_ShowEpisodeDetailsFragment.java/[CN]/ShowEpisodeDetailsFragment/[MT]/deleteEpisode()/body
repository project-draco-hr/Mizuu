{
  AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
  View dialogLayout=getActivity().getLayoutInflater().inflate(R.layout.delete_file_dialog_layout,null);
  final CheckBox cb=(CheckBox)dialogLayout.findViewById(R.id.deleteFile);
  cb.setChecked(PreferenceManager.getDefaultSharedPreferences(getActivity()).getBoolean(ALWAYS_DELETE_FILE,true));
  builder.setTitle(getString(R.string.removeEpisode) + " S" + thisEpisode.getSeason()+ "E"+ thisEpisode.getEpisode()).setView(dialogLayout).setCancelable(false).setPositiveButton(getString(android.R.string.yes),new DialogInterface.OnClickListener(){
    public void onClick(    DialogInterface dialog,    int id){
      dbHelper=MizuuApplication.getTvEpisodeDbAdapter();
      boolean deleted=false;
      if (ignoreDeletedFiles)       deleted=dbHelper.ignoreEpisode(thisEpisode.getRowId());
 else       deleted=dbHelper.deleteEpisode(thisEpisode.getRowId());
      if (deleted) {
        try {
          File episodePhoto=MizLib.getTvShowEpisode(getActivity(),thisEpisode.getShowId(),thisEpisode.getSeason(),thisEpisode.getEpisode());
          if (episodePhoto.exists()) {
            MizLib.deleteFile(episodePhoto);
          }
        }
 catch (        NullPointerException e) {
        }
        if (dbHelper.getEpisodeCount(thisEpisode.getShowId()) == 0) {
          DbAdapterTvShow dbShow=MizuuApplication.getTvDbAdapter();
          boolean deletedShow=dbShow.deleteShow(thisEpisode.getShowId());
          if (deletedShow) {
            MizLib.deleteFile(MizLib.getTvShowThumb(getActivity(),thisEpisode.getShowId()));
            MizLib.deleteFile(MizLib.getTvShowBackdrop(getActivity(),thisEpisode.getShowId()));
          }
        }
        if (cb.isChecked()) {
          Intent deleteIntent=new Intent(getActivity(),DeleteFile.class);
          deleteIntent.putExtra("filepath",thisEpisode.getFilepath());
          getActivity().startService(deleteIntent);
        }
        notifyDatasetChanges();
        getActivity().finish();
        return;
      }
 else {
        Toast.makeText(getActivity(),getString(R.string.failedToRemoveEpisode),Toast.LENGTH_SHORT).show();
      }
    }
  }
).setNegativeButton(getString(android.R.string.no),new DialogInterface.OnClickListener(){
    public void onClick(    DialogInterface dialog,    int id){
      dialog.cancel();
    }
  }
).show();
}
