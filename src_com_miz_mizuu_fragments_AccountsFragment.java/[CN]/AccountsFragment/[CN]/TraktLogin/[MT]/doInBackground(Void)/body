{
  username=traktUser.getText().toString().trim();
  password=traktPass.getText().toString().trim();
  boolean success=false;
  HttpClient httpclient=new DefaultHttpClient();
  HttpPost httppost=new HttpPost("http://api.trakt.tv/account/test/" + MizLib.TRAKT_API);
  try {
    List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(2);
    nameValuePairs.add(new BasicNameValuePair("username",username));
    nameValuePairs.add(new BasicNameValuePair("password",MizLib.SHA1(password)));
    httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));
    ResponseHandler<String> responseHandler=new BasicResponseHandler();
    String html=httpclient.execute(httppost,responseHandler);
    JSONObject jObject=new JSONObject(html);
    String status=jObject.getString("status");
    success=status.equals("success");
  }
 catch (  Exception e) {
    success=false;
  }
  if (success) {
    Editor editor=settings.edit();
    editor.putString(TRAKT_USERNAME,username);
    editor.putString(TRAKT_PASSWORD,MizLib.SHA1(password));
    editor.commit();
    httpclient=new DefaultHttpClient();
    httppost=new HttpPost("http://api.trakt.tv/user/profile.json/" + MizLib.TRAKT_API + "/"+ username);
    try {
      List<NameValuePair> nameValuePairs=new ArrayList<NameValuePair>(2);
      nameValuePairs.add(new BasicNameValuePair("username",username));
      nameValuePairs.add(new BasicNameValuePair("password",MizLib.SHA1(password)));
      httppost.setEntity(new UrlEncodedFormEntity(nameValuePairs));
      ResponseHandler<String> responseHandler=new BasicResponseHandler();
      String html=httpclient.execute(httppost,responseHandler);
      JSONObject jObject=new JSONObject(html);
      String name=jObject.getString("full_name");
      if (name.equals("null") || name.isEmpty())       name=jObject.getString("username");
      String avatar=jObject.getString("avatar");
      editor.putString(TRAKT_FULL_NAME,name);
      editor.commit();
      if (isAdded() && (avatar.contains("gravatar") || (avatar.contains("trakt") && !avatar.contains("avatar-large.jpg"))))       MizLib.downloadFile(avatar,new File(MizLib.getCacheFolder(getActivity()),"avatar.jpg").getAbsolutePath());
    }
 catch (    Exception e) {
      success=false;
    }
  }
  return success;
}
