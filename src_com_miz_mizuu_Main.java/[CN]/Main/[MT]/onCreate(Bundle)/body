{
  super.onCreate(savedInstanceState);
  MizuuApplication.setupTheme(this);
  setContentView(R.layout.menu_drawer);
  SharedPreferences settings=PreferenceManager.getDefaultSharedPreferences(this);
  confirmExit=settings.getBoolean("prefsConfirmBackPress",false);
  startup=settings.getString("prefsStartup","1");
  if (startup.equals("0"))   startup="1";
  dbHelper=MizuuApplication.getMovieAdapter();
  dbHelperTv=MizuuApplication.getTvDbAdapter();
  tfCondensed=MizuuApplication.getOrCreateTypeface(getApplicationContext(),"RobotoCondensed-Regular.ttf");
  tf=MizuuApplication.getOrCreateTypeface(getApplicationContext(),"Roboto-Medium.ttf");
  tfLight=MizuuApplication.getOrCreateTypeface(getApplicationContext(),"Roboto-Light.ttf");
  setupMenuItems();
  mDrawerUserInfo=findViewById(R.id.drawer_user_info);
  mDrawerLayout=(DrawerLayout)findViewById(R.id.drawer_layout);
  mDrawerLayout.setDrawerShadow(R.drawable.drawer_list_shadow,GravityCompat.START);
  if ((!MizLib.isTablet(this) && !MizLib.isPortrait(this)) || MizLib.isGoogleTV(this)) {
    findViewById(R.id.personalizedArea).setVisibility(View.GONE);
  }
 else   setupUserDetails();
  ((TextView)findViewById(R.id.username)).setTextSize(26f);
  ((TextView)findViewById(R.id.username)).setTypeface(tfCondensed);
  tab1=(TextView)findViewById(R.id.tab1);
  tab1.setTextSize(12f);
  tab2=(TextView)findViewById(R.id.tab2);
  tab2.setTextSize(12f);
  mDrawerList=(ListView)findViewById(R.id.listView1);
  mDrawerList.setAdapter(new MenuAdapter());
  mDrawerList.setOnItemClickListener(new OnItemClickListener(){
    @Override public void onItemClick(    AdapterView<?> arg0,    View arg1,    int arg2,    long arg3){
      if (tab1.isSelected()) {
        loadFragment(arg2 + 1);
      }
 else {
        final PackageManager pm=getPackageManager();
        Intent i=pm.getLaunchIntentForPackage(thirdPartyApps.get(arg2).getPackageName());
        if (i != null) {
          i.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);
          startActivity(i);
        }
        mDrawerList.setItemChecked(arg2,false);
      }
    }
  }
);
  mDrawerList.setOnItemSelectedListener(new OnItemSelectedListener(){
    @Override public void onItemSelected(    AdapterView<?> arg0,    View arg1,    int arg2,    long arg3){
    }
    @Override public void onNothingSelected(    AdapterView<?> arg0){
    }
  }
);
  getActionBar().setDisplayHomeAsUpEnabled(true);
  if (MizLib.hasICS())   getActionBar().setHomeButtonEnabled(true);
  mDrawerToggle=new ActionBarDrawerToggle(this,mDrawerLayout,R.drawable.ic_drawer,R.string.drawer_open,R.string.drawer_close){
    public void onDrawerClosed(    View view){
      getActionBar().setTitle(null);
      invalidateOptionsMenu();
    }
    public void onDrawerOpened(    View drawerView){
      invalidateOptionsMenu();
      if (MizLib.isGoogleTV(getApplicationContext()))       mDrawerList.requestFocus();
    }
  }
;
  mDrawerLayout.setDrawerListener(mDrawerToggle);
  if (savedInstanceState != null && savedInstanceState.containsKey("tabIndex")) {
    selectedIndex=savedInstanceState.getInt("selectedIndex");
    changeTabSelection(savedInstanceState.getInt("tabIndex"));
    loadFragment(selectedIndex + 1);
  }
 else   if (getIntent().getExtras() != null && getIntent().getExtras().containsKey("startup")) {
    tab1.setSelected(true);
    loadFragment(Integer.parseInt(getIntent().getExtras().getString("startup")));
  }
 else {
    tab1.setSelected(true);
    loadFragment(Integer.parseInt(startup));
  }
  LocalBroadcastManager.getInstance(this).registerReceiver(mMessageReceiver,new IntentFilter("mizuu-movies-update"));
  LocalBroadcastManager.getInstance(this).registerReceiver(mMessageReceiver,new IntentFilter("mizuu-library-change"));
  LocalBroadcastManager.getInstance(this).registerReceiver(mMessageReceiver,new IntentFilter("mizuu-shows-update"));
}
