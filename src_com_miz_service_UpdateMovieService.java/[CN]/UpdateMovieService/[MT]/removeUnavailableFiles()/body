{
  ArrayList<DbMovie> dbMovies=new ArrayList<DbMovie>(), deletedMovies=new ArrayList<DbMovie>();
  DbAdapter db=MizuuApplication.getMovieAdapter();
  Cursor tempCursor=db.fetchAllMovies(DbAdapter.KEY_TITLE + " ASC",ignoreRemovedFiles,true);
  while (tempCursor.moveToNext()) {
    try {
      dbMovies.add(new DbMovie(getApplicationContext(),tempCursor.getString(tempCursor.getColumnIndex(DbAdapter.KEY_FILEPATH)),tempCursor.getLong(tempCursor.getColumnIndex(DbAdapter.KEY_ROWID)),tempCursor.getString(tempCursor.getColumnIndex(DbAdapter.KEY_TMDBID))));
    }
 catch (    NullPointerException e) {
    }
  }
  tempCursor.close();
  ArrayList<FileSource> filesources=MizLib.getFileSources(MizLib.TYPE_MOVIE,true);
  for (int i=0; i < dbMovies.size(); i++) {
    if (dbMovies.get(i).isNetworkFile()) {
      if (MizLib.isWifiConnected(getApplicationContext(),prefsDisableEthernetWiFiCheck) && !dbMovies.get(i).hasOfflineCopy(getApplicationContext())) {
        FileSource source=null;
        for (int j=0; j < filesources.size(); j++)         if (dbMovies.get(i).getFilepath().contains(filesources.get(j).getFilepath())) {
          source=filesources.get(j);
          continue;
        }
        if (source == null) {
          boolean deleted=db.deleteMovie(dbMovies.get(i).getRowId());
          if (deleted)           deletedMovies.add(dbMovies.get(i));
          continue;
        }
        try {
          final SmbFile file=new SmbFile(MizLib.createSmbLoginString(URLEncoder.encode(source.getDomain(),"utf-8"),URLEncoder.encode(source.getUser(),"utf-8"),URLEncoder.encode(source.getPassword(),"utf-8"),dbMovies.get(i).getFilepath(),false));
          if (!file.exists()) {
            boolean deleted=db.deleteMovie(dbMovies.get(i).getRowId());
            if (deleted)             deletedMovies.add(dbMovies.get(i));
          }
        }
 catch (        Exception e) {
        }
      }
    }
 else {
      if (!new File(dbMovies.get(i).getFilepath()).exists()) {
        boolean deleted=db.deleteMovie(dbMovies.get(i).getRowId());
        if (deleted)         deletedMovies.add(dbMovies.get(i));
      }
    }
  }
  int count=deletedMovies.size();
  for (int i=0; i < count; i++) {
    if (!db.movieExists(deletedMovies.get(i).getTmdbId())) {
      MizLib.deleteFile(new File(deletedMovies.get(i).getThumbnail()));
      MizLib.deleteFile(new File(deletedMovies.get(i).getBackdrop()));
    }
  }
  dbMovies.clear();
  deletedMovies.clear();
  filesources.clear();
}
