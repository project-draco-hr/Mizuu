{
  if (mFileUrl.startsWith("http")) {
    InputStream in=null;
    OutputStream fileos=null;
    try {
      int bufferSize=mBufferSize;
      byte[] retVal=null;
      OkHttpClient client=new OkHttpClient();
      Request request=new Request.Builder().url(mFileUrl).build();
      Response response=client.newCall(request).execute();
      if (!response.isSuccessful())       return false;
      File offline=MizLib.getOfflineFile(mContext,mFileUrl);
      offline.createNewFile();
      fileos=new BufferedOutputStream(new FileOutputStream(offline));
      in=new BufferedInputStream(response.body().byteStream(),bufferSize);
      retVal=new byte[bufferSize];
      int length=0;
      while ((length=in.read(retVal)) > -1) {
        if (mStopDownload) {
          fileos.close();
          in.close();
          return false;
        }
        fileos.write(retVal,0,length);
        mCurrentLength+=length;
        update();
      }
      return true;
    }
 catch (    Exception e) {
      return false;
    }
 finally {
      if (fileos != null) {
        try {
          fileos.flush();
          fileos.close();
        }
 catch (        IOException e) {
        }
      }
      if (in != null) {
        try {
          in.close();
        }
 catch (        IOException e) {
        }
      }
    }
  }
 else {
    try {
      File offline=MizLib.getOfflineFile(mContext,mSmb.getCanonicalPath());
      offline.createNewFile();
      mTotalLength=mSmb.length();
      OutputStream os=new BufferedOutputStream(new FileOutputStream(offline),mBufferSize);
      BufferedInputStream in=new BufferedInputStream(new SmbFileInputStream(mSmb),mBufferSize);
      byte[] b=new byte[mBufferSize];
      int n;
      while ((n=in.read(b)) != -1) {
        if (mStopDownload) {
          os.close();
          in.close();
          return false;
        }
        os.write(b,0,n);
        mCurrentLength+=n;
        update();
      }
      os.close();
      in.close();
      return true;
    }
 catch (    Exception ignored) {
      return false;
    }
  }
}
